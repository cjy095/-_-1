<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Site Board</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #fff;
    padding: 60px;
  }

  h1 {
    text-align: center;
    margin-bottom: 40px;
    font-size: 28px;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 40px;
  }

  .card {
    border: 2px solid #000;
    border-radius: 28px;
    padding: 32px;
    height: fit-content;
  }

  .card-title {
    width: 100%;
    border: none;
    outline: none;
    text-align: center;
    font-weight: bold;
    font-size: 20px;
    margin-bottom: 16px;
  }

  .controls {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 24px;
    flex-wrap: wrap;
  }

  .controls button {
    border: 1.5px solid #000;
    background: #fff;
    padding: 6px 12px;
    border-radius: 999px;
    font-size: 13px;
    cursor: pointer;
  }

  .sites {
    display: grid;
    gap: 22px;
    grid-auto-rows: minmax(44px, auto);
  }

  .url-input {
    width: 100%;
    padding: 12px 16px;
    border-radius: 999px;
    border: 1.5px solid #000;
    font-size: 14px;
  }

  .site-preview {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
  }

  .favicon {
    width: 20px;
    height: 20px;
  }

  .site-name {
    border: none;
    outline: none;
    font-size: 15px;
    background: transparent;
    width: 100%;
  }
</style>
</head>
<body>

<h1>site</h1>
<div class="grid" id="grid"></div>

<script>
const CARD_COUNT = 6
const MIN = 1
const MAX = 8
const STORAGE_KEY = 'site-board-data'

let data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || []

if (data.length === 0) {
  for (let i = 0; i < CARD_COUNT; i++) {
    data.push({ title: '', cols: 3, rows: 2, sites: [] })
  }
}

function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data))
}

function render() {
  const grid = document.getElementById('grid')
  grid.innerHTML = ''

  data.forEach((cardData, index) => {
    const card = document.createElement('div')
    card.className = 'card'
    card.dataset.index = index

    card.innerHTML = `
      <input class="card-title" placeholder="타이핑">
      <div class="controls">
        <button data-col="-1">– 열</button>
        <button data-col="1">+ 열</button>
        <button data-row="-1">– 행</button>
        <button data-row="1">+ 행</button>
      </div>
      <div class="sites"></div>
    `

    const title = card.querySelector('.card-title')
    title.value = cardData.title
    title.oninput = () => {
      cardData.title = title.value
      save()
    }

    card.querySelectorAll('.controls button').forEach(btn => {
      btn.onclick = e => {
        const cardEl = e.target.closest('.card')
        const i = Number(cardEl.dataset.index)

        if (btn.dataset.col) {
          data[i].cols = clamp(data[i].cols + Number(btn.dataset.col))
        }
        if (btn.dataset.row) {
          data[i].rows = clamp(data[i].rows + Number(btn.dataset.row))
        }
        save()
        render()
      }
    })

    const sites = card.querySelector('.sites')
    sites.style.gridTemplateColumns = `repeat(${cardData.cols}, 1fr)`

    const maxVisible = cardData.cols * cardData.rows

    cardData.sites.slice(0, maxVisible).forEach(site => {
      sites.appendChild(createPreview(site, index))
    })

    while (sites.children.length < maxVisible) {
      sites.appendChild(createInput(index))
    }

    grid.appendChild(card)
  })
}

function clamp(n) {
  return Math.max(MIN, Math.min(MAX, n))
}

function createInput(cardIndex) {
  const input = document.createElement('input')
  input.className = 'url-input'
  input.placeholder = '사이트 URL'
  input.onblur = () => addSite(input, cardIndex)
  return input
}

function addSite(input, cardIndex) {
  const url = input.value.trim()
  if (!url) return

  try {
    const full = url.startsWith('http') ? url : 'https://' + url
    const parsed = new URL(full)

    data[cardIndex].sites.push({
      url: full,
      name: parsed.hostname.replace('www.', '')
    })

    save()
    render()
  } catch {}
}

function createPreview(site, cardIndex) {
  const wrap = document.createElement('div')
  wrap.className = 'site-preview'

  wrap.innerHTML = `
    <img class="favicon" src="https://www.google.com/s2/favicons?domain=${site.url}&sz=64">
    <input class="site-name">
  `

  const name = wrap.querySelector('.site-name')
  name.value = site.name
  name.oninput = () => {
    site.name = name.value
    save()
  }

  wrap.onclick = () => window.open(site.url, '_blank')

  wrap.oncontextmenu = e => {
    e.preventDefault()
    if (confirm('이 사이트를 삭제할까요?')) {
      data[cardIndex].sites = data[cardIndex].sites.filter(s => s !== site)
      save()
      render()
    }
  }

  return wrap
}

render()
</script>

</body>
</html>
